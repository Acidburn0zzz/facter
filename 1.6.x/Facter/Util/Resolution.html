<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Facter::Util::Resolution
  
    &mdash; Documentation by YARD 0.8.1
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/docco.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/docco.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Facter.html" title="Facter (module)">Facter</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Util.html" title="Facter::Util (module)">Util</a></span></span>
     &raquo; 
    <span class="title">Resolution</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Facter::Util::Resolution
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Facter::Util::Resolution</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/facter/util/resolution.rb</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="INTERPRETER-constant" class="">INTERPRETER =
          
        </dt>
        <dd><pre class="code"><span class='const'>Facter</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_is_windows?'>is_windows?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cmd.exe</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/bin/sh</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#code-instance_method" title="#code (instance method)">- (Object) <strong>code</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute code.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#interpreter-instance_method" title="#interpreter (instance method)">- (Object) <strong>interpreter</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute interpreter.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#name-instance_method" title="#name (instance method)">- (Object) <strong>name</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute name.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout-instance_method" title="#timeout (instance method)">- (Object) <strong>timeout</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute timeout.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exec-class_method" title="exec (class method)">+ (Object) <strong>exec</strong>(code, interpreter = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Execute a program and return the output of that program.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#have_which-class_method" title="have_which (class method)">+ (Object) <strong>have_which</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#confine-instance_method" title="#confine (instance method)">- (Object) <strong>confine</strong>(confines) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add a new confine to the resolution mechanism.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_weight-instance_method" title="#has_weight (instance method)">- (Object) <strong>has_weight</strong>(weight) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Resolution) <strong>initialize</strong>(name) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new resolution mechanism.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#limit-instance_method" title="#limit (instance method)">- (Object) <strong>limit</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>We need this as a getter for 'timeout', because some versions of ruby seem
to already have a 'timeout' method and we can't seem to override the
instance methods, somehow.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setcode-instance_method" title="#setcode (instance method)">- (Object) <strong>setcode</strong>(string = nil, interp = nil, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set our code for returning a value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#suitable%3F-instance_method" title="#suitable? (instance method)">- (Boolean) <strong>suitable?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Is this resolution mechanism suitable on the system in question?.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_s-instance_method" title="#to_s (instance method)">- (Object) <strong>to_s</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#value-instance_method" title="#value (instance method)">- (Object) <strong>value</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>How we get a value for our resolution mechanism.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#weight-instance_method" title="#weight (instance method)">- (Object) <strong>weight</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return the importance of this resolution.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Facter::Util::Resolution (class)">Resolution</a></span></tt>) <strong>initialize</strong>(name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new resolution mechanism.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93
94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 91</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='ivar'>@name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@confines</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@value</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@timeout</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@weight</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 91</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">91
92
93
94
95
96
97
98</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='ivar'>@name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@confines</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@value</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@timeout</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@weight</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="code=-instance_method"></span>
      <span id="code-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="code-instance_method">
  
    - (<tt>Object</tt>) <strong>code</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute code</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_code'>code</span>
  <span class='ivar'>@code</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 12</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">12
13
14
15</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_code'>code</span>
  <span class='ivar'>@code</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id="interpreter=-instance_method"></span>
      <span id="interpreter-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="interpreter-instance_method">
  
    - (<tt>Object</tt>) <strong>interpreter</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute interpreter</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_interpreter'>interpreter</span>
  <span class='ivar'>@interpreter</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 12</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">12
13
14
15</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_interpreter'>interpreter</span>
  <span class='ivar'>@interpreter</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id="name=-instance_method"></span>
      <span id="name-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="name-instance_method">
  
    - (<tt>Object</tt>) <strong>name</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute name</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 12</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">12
13
14
15</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@name</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      
      <span id="timeout=-instance_method"></span>
      <span id="timeout-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="timeout-instance_method">
  
    - (<tt>Object</tt>) <strong>timeout</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute timeout</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_timeout'>timeout</span>
  <span class='ivar'>@timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 12</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">12
13
14
15</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_timeout'>timeout</span>
  <span class='ivar'>@timeout</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="exec-class_method">
  
    + (<tt>Object</tt>) <strong>exec</strong>(code, interpreter = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Execute a program and return the output of that program.</p>

<p>Returns nil if the program can't be found, or if there is a problem
executing the code.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 33</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='id identifier rubyid_code'>code</span><span class='comma'>,</span> <span class='id identifier rubyid_interpreter'>interpreter</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>Facter</span><span class='period'>.</span><span class='id identifier rubyid_warnonce'>warnonce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The interpreter parameter to 'exec' is deprecated and will be removed in a future version.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_interpreter'>interpreter</span>

  <span class='comment'># Try to guess whether the specified code can be executed by looking at the
</span>  <span class='comment'># first word. If it cannot be found on the PATH defer on resolving the fact
</span>  <span class='comment'># by returning nil.
</span>  <span class='comment'># This only fails on shell built-ins, most of which are masked by stuff in
</span>  <span class='comment'># /bin or of dubious value anyways. In the worst case, &quot;sh -c 'builtin'&quot; can
</span>  <span class='comment'># be used to work around this limitation
</span>  <span class='comment'>#
</span>  <span class='comment'># Windows' %x{} throws Errno::ENOENT when the command is not found, so we
</span>  <span class='comment'># can skip the check there. This is good, since builtins cannot be found
</span>  <span class='comment'># elsewhere.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_have_which'>have_which</span> <span class='kw'>and</span> <span class='op'>!</span><span class='const'>Facter</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_is_windows?'>is_windows?</span>
    <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_binary'>binary</span> <span class='op'>=</span> <span class='id identifier rubyid_code'>code</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_code'>code</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\/</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_binary'>binary</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='backtick'>%x{</span><span class='tstring_content'>which </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_binary'>binary</span><span class='rbrace'>}</span><span class='tstring_content'> 2&gt;/dev/null</span><span class='tstring_end'>}</span></span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
      <span class='comment'># we don't have the binary necessary
</span>      <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_path'>path</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>or</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>Command not found\.</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='const'>FileTest</span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_out'>out</span> <span class='op'>=</span> <span class='backtick'>%x{</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_code'>code</span><span class='rbrace'>}</span><span class='tstring_end'>}</span></span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='comment'># command not found on Windows
</span>    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_out'>out</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_out'>out</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 33</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">33
34
35
36</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def self.exec(code, interpreter = nil)
  Facter.warnonce &quot;The interpreter parameter to 'exec' is deprecated and will be removed in a future version.&quot; if interpreter
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    
<p>Try to guess whether the specified code can be executed by looking at the
first word. If it cannot be found on the PATH defer on resolving the fact
by returning nil. This only fails on shell built-ins, most of which are
masked by stuff in /bin or of dubious value anyways. In the worst case, "sh
-c 'builtin'" can be used to work around this limitation</p>

<p>Windows' %x{} throws Errno::ENOENT when the command is not found, so we can
skip the check there. This is good, since builtins cannot be found
elsewhere.</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">46
47
48
49
50
51
52
53</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">  if have_which and !Facter::Util::Config.is_windows?
    path = nil
    binary = code.split.first
    if code =~ /^\//
      path = binary
    else
      path = %x{which #{binary} 2&gt;/dev/null}.chomp</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    
<p>we don't have the binary necessary</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">54
55
56
57
58
59
60
61
62
63
64
65</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">      return nil if path == &quot;&quot; or path.match(/Command not found\./)
    end

    return nil unless FileTest.exists?(path)
  end

  out = nil

  begin
    out = %x{#{code}}.chomp
  rescue Errno::ENOENT =&gt; detail</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    
<p>command not found on Windows</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    return nil
  rescue =&gt; detail
    $stderr.puts detail
    return nil
  end

  if out == &quot;&quot;
    return nil
  else
    return out
  end
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <h3 class="signature " id="have_which-class_method">
  
    + (<tt>Object</tt>) <strong>have_which</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


16
17
18
19
20
21
22
23
24
25
26</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 16</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_have_which'>have_which</span>
  <span class='kw'>if</span> <span class='op'>!</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@have_which</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='ivar'>@have_which</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='const'>Facter</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_is_windows?'>is_windows?</span>
      <span class='ivar'>@have_which</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>else</span>
      <span class='backtick'>%x{</span><span class='tstring_content'>which which &gt;/dev/null 2&gt;&amp;1</span><span class='tstring_end'>}</span></span>
      <span class='ivar'>@have_which</span> <span class='op'>=</span> <span class='gvar'>$?</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@have_which</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 16</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">16
17
18
19
20
21
22
23
24
25
26
27</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_have_which'>have_which</span>
  <span class='kw'>if</span> <span class='op'>!</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@have_which</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='ivar'>@have_which</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>if</span> <span class='const'>Facter</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Config</span><span class='period'>.</span><span class='id identifier rubyid_is_windows?'>is_windows?</span>
      <span class='ivar'>@have_which</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='kw'>else</span>
      <span class='backtick'>%x{</span><span class='tstring_content'>which which &gt;/dev/null 2&gt;&amp;1</span><span class='tstring_end'>}</span></span>
      <span class='ivar'>@have_which</span> <span class='op'>=</span> <span class='gvar'>$?</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='ivar'>@have_which</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="confine-instance_method">
  
    - (<tt>Object</tt>) <strong>confine</strong>(confines) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add a new confine to the resolution mechanism.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_confine'>confine</span><span class='lparen'>(</span><span class='id identifier rubyid_confines'>confines</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_confines'>confines</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fact'>fact</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='op'>|</span>
    <span class='ivar'>@confines</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='const'>Facter</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Confine</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_fact'>fact</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 80</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">80
81
82
83
84
85</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_confine'>confine</span><span class='lparen'>(</span><span class='id identifier rubyid_confines'>confines</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_confines'>confines</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_fact'>fact</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='op'>|</span>
    <span class='ivar'>@confines</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='const'>Facter</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Confine</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_fact'>fact</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <h3 class="signature " id="has_weight-instance_method">
  
    - (<tt>Object</tt>) <strong>has_weight</strong>(weight) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 86</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_weight'>has_weight</span><span class='lparen'>(</span><span class='id identifier rubyid_weight'>weight</span><span class='rparen'>)</span>
  <span class='ivar'>@weight</span> <span class='op'>=</span> <span class='id identifier rubyid_weight'>weight</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 86</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">86
87
88
89</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_has_weight'>has_weight</span><span class='lparen'>(</span><span class='id identifier rubyid_weight'>weight</span><span class='rparen'>)</span>
  <span class='ivar'>@weight</span> <span class='op'>=</span> <span class='id identifier rubyid_weight'>weight</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <h3 class="signature " id="limit-instance_method">
  
    - (<tt>Object</tt>) <strong>limit</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>We need this as a getter for 'timeout', because some versions of ruby seem
to already have a 'timeout' method and we can't seem to override the
instance methods, somehow.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 111</span>

<span class='kw'>def</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='ivar'>@timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 111</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">111
112
113
114</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='ivar'>@timeout</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <h3 class="signature " id="setcode-instance_method">
  
    - (<tt>Object</tt>) <strong>setcode</strong>(string = nil, interp = nil, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set our code for returning a value.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118
119
120
121
122
123
124
125
126
127</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 116</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setcode'>setcode</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_interp'>interp</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='const'>Facter</span><span class='period'>.</span><span class='id identifier rubyid_warnonce'>warnonce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The interpreter parameter to 'setcode' is deprecated and will be removed in a future version.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_interp'>interp</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_string'>string</span>
    <span class='ivar'>@code</span> <span class='op'>=</span> <span class='id identifier rubyid_string'>string</span>
    <span class='ivar'>@interpreter</span> <span class='op'>=</span> <span class='id identifier rubyid_interp'>interp</span> <span class='op'>||</span> <span class='const'>INTERPRETER</span>
  <span class='kw'>else</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must pass either code or a block</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='ivar'>@code</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 116</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">116
117
118
119
120
121
122
123
124
125
126
127
128</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_setcode'>setcode</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_interp'>interp</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='const'>Facter</span><span class='period'>.</span><span class='id identifier rubyid_warnonce'>warnonce</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The interpreter parameter to 'setcode' is deprecated and will be removed in a future version.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_interp'>interp</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_string'>string</span>
    <span class='ivar'>@code</span> <span class='op'>=</span> <span class='id identifier rubyid_string'>string</span>
    <span class='ivar'>@interpreter</span> <span class='op'>=</span> <span class='id identifier rubyid_interp'>interp</span> <span class='op'>||</span> <span class='const'>INTERPRETER</span>
  <span class='kw'>else</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must pass either code or a block</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='ivar'>@code</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <h3 class="signature " id="suitable?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>suitable?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Is this resolution mechanism suitable on the system in question?</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_suitable?'>suitable?</span>
  <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@suitable</span>
    <span class='ivar'>@suitable</span> <span class='op'>=</span> <span class='op'>!</span> <span class='ivar'>@confines</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_confine'>confine</span><span class='op'>|</span> <span class='op'>!</span> <span class='id identifier rubyid_confine'>confine</span><span class='period'>.</span><span class='id identifier rubyid_true?'>true?</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='ivar'>@suitable</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 140</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">140
141
142
143
144
145
146
147</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_suitable?'>suitable?</span>
  <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@suitable</span>
    <span class='ivar'>@suitable</span> <span class='op'>=</span> <span class='op'>!</span> <span class='ivar'>@confines</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_confine'>confine</span><span class='op'>|</span> <span class='op'>!</span> <span class='id identifier rubyid_confine'>confine</span><span class='period'>.</span><span class='id identifier rubyid_true?'>true?</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='ivar'>@suitable</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <h3 class="signature " id="to_s-instance_method">
  
    - (<tt>Object</tt>) <strong>to_s</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 148</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 148</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">148
149
150
151</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>return</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='lparen'>(</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <h3 class="signature " id="value-instance_method">
  
    - (<tt>Object</tt>) <strong>value</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>How we get a value for our resolution mechanism.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 153</span>

<span class='kw'>def</span> <span class='id identifier rubyid_value'>value</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span> <span class='kw'>if</span> <span class='ivar'>@code</span> <span class='op'>==</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_starttime'>starttime</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>

  <span class='kw'>begin</span>
    <span class='const'>Timeout</span><span class='period'>.</span><span class='id identifier rubyid_timeout'>timeout</span><span class='lparen'>(</span><span class='id identifier rubyid_limit'>limit</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='kw'>if</span> <span class='ivar'>@code</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Proc</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='ivar'>@code</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'>Facter</span><span class='op'>::</span><span class='const'>Util</span><span class='op'>::</span><span class='const'>Resolution</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='ivar'>@code</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_detail'>detail</span>
    <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Timed out seeking value for %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>

    <span class='comment'># This call avoids zombies -- basically, create a thread that will
</span>    <span class='comment'># dezombify all of the child processes that we're ignoring because
</span>    <span class='comment'># of the timeout.
</span>    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='const'>Process</span><span class='period'>.</span><span class='id identifier rubyid_waitall'>waitall</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_details'>details</span>
    <span class='id identifier rubyid_warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not retrieve %s: %s</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_details'>details</span><span class='rbracket'>]</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_finishtime'>finishtime</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
  <span class='id identifier rubyid_ms'>ms</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_finishtime'>finishtime</span> <span class='op'>-</span> <span class='id identifier rubyid_starttime'>starttime</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='int'>1000</span>
  <span class='const'>Facter</span><span class='period'>.</span><span class='id identifier rubyid_show_time'>show_time</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%.2f</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_ms'>ms</span><span class='rbrace'>}</span><span class='tstring_content'>ms</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 153</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">def value
  result = nil
  return result if @code == nil

  starttime = Time.now.to_f

  begin
    Timeout.timeout(limit) do
      if @code.is_a?(Proc)
        result = @code.call()
      else
        result = Facter::Util::Resolution.exec(@code)
      end
    end
  rescue Timeout::Error =&gt; detail
    warn &quot;Timed out seeking value for %s&quot; % self.name
</pre>
      </td>
    </tr>
  
    <tr>
      <td class="comment">
        <span><div class="docstring">
  <div class="discussion">
    
<p>This call avoids zombies -- basically, create a thread that will dezombify
all of the child processes that we're ignoring because of the timeout.</p>


  </div>
</div>
<div class="tags">
  

</div>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file">    Thread.new { Process.waitall }
    return nil
  rescue =&gt; details
    warn &quot;Could not retrieve %s: %s&quot; % [self.name, details]
    return nil
  end

  finishtime = Time.now.to_f
  ms = (finishtime - starttime) * 1000
  Facter.show_time &quot;#{self.name}: #{&quot;%.2f&quot; % ms}ms&quot;

  return nil if result == &quot;&quot;
  return result
end</pre>
      </td>
    </tr>
  

</table>
    
      <div class="method_details ">
  <h3 class="signature " id="weight-instance_method">
  
    - (<tt>Object</tt>) <strong>weight</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return the importance of this resolution.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 100</span>

<span class='kw'>def</span> <span class='id identifier rubyid_weight'>weight</span>
  <span class='kw'>if</span> <span class='ivar'>@weight</span>
    <span class='ivar'>@weight</span>
  <span class='kw'>else</span>
    <span class='ivar'>@confines</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div><table class="annotated_source_code">
  <tr>
    <td colspan="3" style="padding-left: 10px;">
      <pre class="code"><span class="info file"># File 'lib/facter/util/resolution.rb', line 100</span></pre>
    </td>
  </tr>
  
    <tr>
      <td class="comment">
        <span>  
      </td>
      <td class="line-numbers">
        <pre class="lines" style="padding-right: 0px;">100
101
102
103
104
105
106
107</pre>
      </td>
      <td class="code">
        <pre class="code"><span class="info file"><span class='kw'>def</span> <span class='id identifier rubyid_weight'>weight</span>
  <span class='kw'>if</span> <span class='ivar'>@weight</span>
    <span class='ivar'>@weight</span>
  <span class='kw'>else</span>
    <span class='ivar'>@confines</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  

</table>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue May 22 18:48:38 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.1 (ruby-1.9.3).
</div>

  </body>
</html>